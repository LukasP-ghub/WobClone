{"version":3,"sources":["features/searcher/SearchBar.module.scss","features/searcher/SearchBar.tsx","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"],"names":["module","exports","closeIcon","styles","ellipsis","searchBar","searchBtn","searchInput","searchResultsList","underText","wrapper","SearchBar","dispatch","useAppDispatch","ebooks","useAppSelector","selectEbooks","searchKey","selectSearchKey","searchResults","selectSearchResults","listElRef","useRef","inputRef","listCursor","useEffect","fetchForSearch","setSearchResults","timer","setTimeout","authors","titles","ebook","author","firstName","toLowerCase","includes","lastName","push","linkPathName","linkContent","title","authorFirstName","authorLastName","linkState","searchProducts","window","addEventListener","once","clearTimeout","onMouseEnterHandle","e","currentTarget","focus","current","indexOf","className","onKeyDown","itemFocus","keyCode","length","tabIndex","ref","type","autoComplete","placeholder","name","onChange","setSearchKey","target","value","onClick","setShowSearchBar","onMouseLeave","blur","map","item","index","to","pathname","state","onMouseEnter","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","i","F","s","n","done","_e","f","TypeError","err","normalCompletion","didErr","step","next","_e2"],"mappings":"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","file":"static/js/21.d43174b8.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"searchBar\":\"SearchBar_searchBar__14IVZ\",\"wrapper\":\"SearchBar_wrapper__3aplh\",\"closeIcon\":\"SearchBar_closeIcon__evSG6\",\"searchBtn\":\"SearchBar_searchBtn__32SK2\",\"searchInput\":\"SearchBar_searchInput__3DsOd\",\"searchResultsList\":\"SearchBar_searchResultsList__1L9JW\",\"underText\":\"SearchBar_underText__dDeby\",\"ellipsis\":\"SearchBar_ellipsis__2AOwx\"};","import { useEffect, useRef } from 'react';\r\nimport { useAppSelector, useAppDispatch } from '../../helpers/types/hooks';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { selectEbooks, selectSearchKey, selectSearchResults } from './searcherSlice';\r\nimport { setShowSearchBar, setSearchKey, setSearchResults } from './searcherSlice';\r\nimport { fetchForSearch } from './searcherSlice';\r\nimport { SearchResultsPayload } from './searcherSlice';\r\n\r\nimport SearchIcon from '../../assets/svg/SearchIcon';\r\nimport CloseIcon from '../../assets/svg/CloseIcon';\r\nimport styles from './SearchBar.module.scss';\r\n\r\nconst { closeIcon, ellipsis, searchBar, searchBtn, searchInput, searchResultsList, underText, wrapper } = styles;\r\n\r\nconst SearchBar: React.FC = () => {\r\n  const dispatch = useAppDispatch();\r\n  const ebooks = useAppSelector(selectEbooks);\r\n  const searchKey = useAppSelector(selectSearchKey);\r\n  const searchResults = useAppSelector(selectSearchResults);\r\n  const listElRef = useRef<HTMLAnchorElement[]>([]);\r\n  const inputRef = useRef<HTMLInputElement>(null);\r\n\r\n  let listCursor = -1;\r\n\r\n  //function search elements by user key and create array of data for router Links\r\n  const searchProducts = () => {\r\n    const authors = [];\r\n    const titles = [];\r\n\r\n    for (const ebook of ebooks) {\r\n      if (ebook.author.firstName.toLowerCase().includes(searchKey.toLowerCase()) ||\r\n        ebook.author.lastName.toLowerCase().includes(searchKey.toLowerCase())) {\r\n        authors.push({\r\n          linkPathName: `/catalog/${ebook.author.firstName}-${ebook.author.lastName}`,\r\n          linkContent: { title: null, authorFirstName: ebook.author.firstName, authorLastName: ebook.author.lastName },\r\n          linkState: {\r\n            authorFirstName: ebook.author.firstName,\r\n            authorLastName: ebook.author.lastName\r\n          }\r\n        })\r\n      }\r\n\r\n      if (ebook.title.toLowerCase().includes(searchKey.toLowerCase())) {\r\n        titles.push({\r\n          linkPathName: `/ebook/${ebook.title}-${ebook.author.firstName}-${ebook.author.lastName}`,\r\n          linkContent: { title: ebook.title, authorFirstName: ebook.author.firstName, authorLastName: ebook.author.lastName },\r\n          linkState: {\r\n            title: ebook.title,\r\n            authorFirstName: ebook.author.firstName,\r\n            authorLastName: ebook.author.lastName\r\n          }\r\n        })\r\n      }\r\n    }\r\n\r\n    return [...authors, ...titles];\r\n  }\r\n\r\n  //fetching all ebooks for searching simulation \r\n  useEffect(() => {\r\n    dispatch(fetchForSearch(''));\r\n  }, [dispatch])\r\n\r\n  //searching with debounce and avoid empty key searching, \r\n  useEffect((): any => {\r\n    if (!searchKey) {\r\n      return dispatch(setSearchResults([]));\r\n    }\r\n\r\n    let timer = setTimeout(() => {\r\n      dispatch(setSearchResults(searchProducts()));\r\n    }, 500);\r\n\r\n    window.addEventListener('click', () => { dispatch(setSearchResults([])) }, { once: true });\r\n    return () => clearTimeout(timer);\r\n  }, [searchKey, dispatch]);\r\n\r\n  //Handling arrow key navigation through list\r\n  const onKeyHandle = (e: any) => {\r\n    let itemFocus = null;\r\n    if (e.keyCode !== 40 && e.keyCode !== 38) return;\r\n    if (e.keyCode === 40 && listCursor < searchResults.length - 1) listCursor++;\r\n    if (e.keyCode === 38 && listCursor > 0) listCursor--;\r\n    if (searchResults.length > 0) itemFocus = listElRef.current[listCursor]?.focus();\r\n    return itemFocus;\r\n  };\r\n\r\n  //Handling mouse navigation with remembering actual focused item for keyboard navigation\r\n  const onMouseEnterHandle = (e: any) => {\r\n    e.currentTarget.focus();\r\n    listCursor = listElRef.current.indexOf(e.currentTarget);\r\n  };\r\n\r\n  const onMouseLeaveHandle = () => {\r\n    listElRef.current[listCursor]?.blur();\r\n    inputRef.current?.focus();\r\n    listCursor = -1;\r\n  }\r\n\r\n  return (\r\n    <div className={searchBar} onKeyDown={onKeyHandle}\r\n      tabIndex={-1}>\r\n      <div className={wrapper}>\r\n\r\n        <button className={searchBtn}>\r\n          <SearchIcon />\r\n        </button>\r\n\r\n        <input className={searchInput} ref={inputRef} type=\"text\" autoComplete='off' placeholder=\"Szukaj\" name=\"searchField\" onChange={(e) => { dispatch(setSearchKey(e.target.value)) }} />\r\n\r\n        <button className={closeIcon} onClick={() => { dispatch(setShowSearchBar()) }}>\r\n          <CloseIcon />\r\n        </button>\r\n\r\n        {/*---Search Dropdown--- */}\r\n        {searchResults.length > 0 ?\r\n          <ul className={searchResultsList} onMouseLeave={onMouseLeaveHandle}>\r\n\r\n            {searchResults.map((item: SearchResultsPayload, index: number) => (\r\n              <li key={index} >\r\n                <Link to={{\r\n                  pathname: item.linkPathName,\r\n                  state: { ...item.linkState }\r\n                }}\r\n                  ref={(e: any) => listElRef.current[index] = e}\r\n                  onMouseEnter={onMouseEnterHandle}\r\n                >\r\n                  {item.linkContent.title ? <div className={ellipsis}>{item.linkContent.title}</div> : null}\r\n                  {<div className={`${item.linkContent.title ? underText : null}`}>{`${item.linkContent.authorFirstName} ${item.linkContent.authorLastName}`}</div>}\r\n                </Link>\r\n              </li>)\r\n            )}\r\n          </ul> : null}\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SearchBar;","import unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it;\n\n  if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = o[Symbol.iterator]();\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}"],"sourceRoot":""}